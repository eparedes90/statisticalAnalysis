library(ggplot2)
library(forecast)
library(fpp2)
library(zoo)
library(ggpubr)
theme_set(theme_pubr())
theme_set(theme_bw())
basedir <- "/raw/C-1233-/"
months <- list.files(paste0(getwd(), basedir), full.names = F, recursive = F)
for (i in 1:length(months)){
temp <- read_xls(paste0("raw/C-1233-/", months[i]))
colnames(temp) <- temp[4, ]
colnames(temp)
temp <- temp[c(26:38), c(1,2, 4, 5, 7, 11)]
temp[2:6, 1] <- temp[1, 1]
temp[9:13, 1] <- temp[8, 1]
temp <- temp[-7, ]
period <- unlist(strsplit(months[i], split = "_"))
temp$year <- period[1]
temp$mes <- period[2]
temp$mes <- gsub(temp$mes, pattern = ".xls", replacement = "")
if (i == 1){
temp4 <- temp
} else {
temp4 <- rbind(temp4, temp)
}
}
#format
temp4[, 3:8] <- apply(temp4[, 3:8], 2, function(x) as.numeric(x))
options(scipen = 999)
#order
temp4 <- temp4[order(temp4$year, temp4$mes), ]
#formato fecha
temp4$Mes <- paste(temp4$year, temp4$mes, 1, sep ="-")
temp4$Mes <- as.Date(temp4$Mes, format = "%Y-%m-%d")
#more cleaning
temp4 <- temp4[!temp4$`Categoría de Riesgo` == "Peq. Empr. (Miles S/.)", ]
temp4 <- temp4[!temp4$`Categoría de Riesgo` == "Peq. Empr. (Miles S/)", ]
temp4 <- temp4[!temp4$`Categoría de Riesgo` == "Microempr. (Miles S/.)", ]
temp4 <- temp4[!temp4$`Categoría de Riesgo` == "Microempr. (Miles S/)", ]
temp4$`Categoría de Riesgo`[temp4$`Categoría de Riesgo`== "Pérdida"] <- "Perdida"
temp4 <- pivot_longer(temp4, cols = 3:6, names_to = "caja", values_to = "estructura")
temp4$caja[temp4$caja == "CMAC AREQUIPA"] <- "CMAC Arequipa"
temp4$caja[temp4$caja == "CMAC CUSCO S A"] <- "CMAC Cusco"
temp4$caja[temp4$caja == "CMAC PIURA"] <- "CMAC Piura"
temp4$caja[temp4$caja == "CMAC HUANCAYO"] <- "CMAC Huancayo"
##ggplot
categ <- unlist(unique(temp4$`Tipo de Crédito`))
categ
empty_list <- vector(mode = "list", len = 0)
empty_list
table(temp4$`Categoría de Riesgo`)
categ2 <- unlist(unique(temp4$`Categoría de Riesgo`))
for (n in 1:length(categ2)){
for (i in 1:length(categ)){
temp5 <- temp4[temp4$`Tipo de Crédito` == categ[i] &
temp4$`Categoría de Riesgo`== categ2[n], ]
empty_list[[i]] <- local({
i <- i
a <- ggplot(temp5[temp5$Mes >= "2019-01-01", ], aes(x = Mes, y = estructura, group = caja))+
geom_line(aes(linetype = caja, color = caja), size = 1)+
geom_point(aes(color = caja, shape = caja), size = 2)+
theme(legend.title = element_blank())+
labs(x = "",
y = "Porcentaje",
title = paste("Categoría de Riesgo", categ2[n],
"-",
categ[i],
sep = " "))
print(a)
})
}
grid_creditos <- ggarrange(empty_list[[1]], empty_list[[2]],
labels = c("", ""),
common.legend = T,
legend = "right",
nrow = 2)
grid_creditos
ggsave(paste("C-1233-", categ2[n], "_2.png", sep = ""), width = 8, height = 6.5)
}
#Morosidad por sector econ?mico
#Cr?ditos Directos Corporativos, a Grandes, Medianas, Peque?as y
#a Microempresas  por Sector Econ?mico y  Caja Municipal
rm(list = ls())
library(readxl)
library(dplyr)
library(tidyr)
library(stringr)
library(tseries)
library(ggplot2)
library(forecast)
library(fpp2)
library(ggpubr)
library(scales)
theme_set(theme_pubr())
theme_set(theme_bw())
basedir <- "/raw/C-1216-/"
months <- list.files(paste0(getwd(), basedir), full.names = F, recursive = F)
for (i in 1:length(months)){
temp <- read_xls(paste0("raw/C-1216-/", months[i]))
temp <- temp[, c(1, 2, 3, 5, 9)]
colnames(temp) <- temp[5, ]
temp <- temp[27, ]
period <- unlist(strsplit(months[i], split = "_"))
temp$year <- period[1]
temp$mes <- period[2]
temp$mes <- gsub(temp$mes, pattern = ".xls", replacement = "")
if (i == 1){
temp2 <- temp
} else {
temp2 <- rbind(temp2, temp)
}
}
#format
temp2[, 2:7] <- apply(temp2[, 2:7], 2, function(x) as.numeric(x))
#order
temp2 <- temp2[order(temp2$year, temp2$mes), ]
#ggplot
temp3 <- pivot_longer(temp2, cols = 2:5, names_to = "caja", values_to = "morosidad")
temp3$Mes <- paste(temp3$year, temp3$mes, 1, sep ="-")
temp3$Mes <- as.Date(temp3$Mes, format = "%Y-%m-%d")
temp3$morosidad <- temp3$morosidad/1000
temp3 <- temp3 <- temp3[temp3$caja == "CMAC Arequipa"|
temp3$caja == "CMAC Huancayo", ]
millones <- ggplot(temp3, aes(x = Mes, y = morosidad, group = caja))+
geom_line(aes(linetype = caja, color = caja), size = 1)+
geom_point(aes(color = caja, shape = caja), size = 2)+
theme(legend.title = element_blank())+
labs(x = "",
y = "Millones de soles",
title = "Créditos Directos",
subtitle = "Corporativos, Grandes, Medianas, Pequeñas y Microempresas")
millones
ggsave("plots/C-1216-CreditosDirectos.jpg", width = 8, height = 6.5)
###cambiar a variaci?n porcentual
temp4 <- temp2
temp4$`CMAC Arequipa`[13:69] <- (temp4$`CMAC Arequipa`[13:69]/temp4$`CMAC Arequipa`[1:57]-1)*100
temp4$`CMAC Cusco`[13:69] <- (temp4$`CMAC Cusco`[13:69]/temp4$`CMAC Cusco`[1:57]-1)*100
temp4$`CMAC Huancayo`[13:69] <- (temp4$`CMAC Huancayo`[13:69]/temp4$`CMAC Huancayo`[1:57]-1)*100
temp4$`CMAC Piura`[13:69] <- (temp4$`CMAC Piura`[13:69]/temp4$`CMAC Piura`[1:57]-1)*100
#pivot temp3 to temp4 to make the plot
temp4 <- pivot_longer(temp4, cols = 2:5, names_to = "caja", values_to = "morosidad_var")
temp4$Mes <- paste(temp4$year, temp4$mes, 1, sep ="-")
temp4$Mes <- as.Date(temp4$Mes, format = "%Y-%m-%d")
temp4 <- temp4[temp4$caja == "CMAC Arequipa"|
temp4$caja == "CMAC Huancayo", ]
varia <- ggplot(temp4[temp4$Mes>="2017-01-01",], aes(x = Mes, y = morosidad_var, group = caja))+
geom_line(aes(linetype = caja, color = caja), size = 1)+
geom_point(aes(color = caja, shape = caja), size = 2)+
theme(legend.title = element_blank())+
scale_y_continuous(breaks = c(0, 20.75, 41.5, 62.25))+
labs(x = "",
y = "Variación porcentual")
varia
ggsave("plots/C-1216-CreditosDirectos_var.jpg", width = 8, height = 6.5)
grid_creditos <- ggarrange(millones, varia,
labels = c("", ""),
common.legend = T,
legend = "right",
nrow = 2)
grid_creditos
ggsave("plots/C-1216-CreditosDirectos_2.png", width = 8, height = 6.5)
rm(list = ls())
library(readxl)
library(dplyr)
library(tidyr)
library(stringr)
library(tseries)
library(ggplot2)
library(forecast)
library(fpp2)
library(zoo)
library(ggpubr)
theme_set(theme_pubr())
theme_set(theme_bw())
basedir <- "/raw/C-1233-/"
months <- list.files(paste0(getwd(), basedir), full.names = F, recursive = F)
for (i in 1:length(months)){
temp <- read_xls(paste0("raw/C-1233-/", months[i]))
colnames(temp) <- temp[4, ]
colnames(temp)
temp <- temp[c(26:38), c(1,2, 4, 5, 7, 11)]
temp[2:6, 1] <- temp[1, 1]
temp[9:13, 1] <- temp[8, 1]
temp <- temp[-7, ]
period <- unlist(strsplit(months[i], split = "_"))
temp$year <- period[1]
temp$mes <- period[2]
temp$mes <- gsub(temp$mes, pattern = ".xls", replacement = "")
if (i == 1){
temp4 <- temp
} else {
temp4 <- rbind(temp4, temp)
}
}
#format
temp4[, 3:8] <- apply(temp4[, 3:8], 2, function(x) as.numeric(x))
options(scipen = 999)
#order
temp4 <- temp4[order(temp4$year, temp4$mes), ]
#formato fecha
temp4$Mes <- paste(temp4$year, temp4$mes, 1, sep ="-")
temp4$Mes <- as.Date(temp4$Mes, format = "%Y-%m-%d")
#more cleaning
temp4 <- temp4[!temp4$`Categoría de Riesgo` == "Peq. Empr. (Miles S/.)", ]
temp4 <- temp4[!temp4$`Categoría de Riesgo` == "Peq. Empr. (Miles S/)", ]
temp4 <- temp4[!temp4$`Categoría de Riesgo` == "Microempr. (Miles S/.)", ]
temp4 <- temp4[!temp4$`Categoría de Riesgo` == "Microempr. (Miles S/)", ]
temp4$`Categoría de Riesgo`[temp4$`Categoría de Riesgo`== "Pérdida"] <- "Perdida"
temp4 <- pivot_longer(temp4, cols = 3:6, names_to = "caja", values_to = "estructura")
temp4$caja[temp4$caja == "CMAC AREQUIPA"] <- "CMAC Arequipa"
temp4$caja[temp4$caja == "CMAC CUSCO S A"] <- "CMAC Cusco"
temp4$caja[temp4$caja == "CMAC PIURA"] <- "CMAC Piura"
temp4$caja[temp4$caja == "CMAC HUANCAYO"] <- "CMAC Huancayo"
##ggplot
categ <- unlist(unique(temp4$`Tipo de Crédito`))
categ
empty_list <- vector(mode = "list", len = 0)
empty_list
table(temp4$`Categoría de Riesgo`)
categ2 <- unlist(unique(temp4$`Categoría de Riesgo`))
for (n in 1:length(categ2)){
for (i in 1:length(categ)){
temp5 <- temp4[temp4$`Tipo de Crédito` == categ[i] &
temp4$`Categoría de Riesgo`== categ2[n], ]
empty_list[[i]] <- local({
i <- i
a <- ggplot(temp5[temp5$Mes >= "2019-01-01", ], aes(x = Mes, y = estructura, group = caja))+
geom_line(aes(linetype = caja, color = caja), size = 1)+
geom_point(aes(color = caja, shape = caja), size = 2)+
theme(legend.title = element_blank())+
labs(x = "",
y = "Porcentaje",
title = paste("Categoría de Riesgo", categ2[n],
"-",
categ[i],
sep = " "))
print(a)
})
}
grid_creditos <- ggarrange(empty_list[[1]], empty_list[[2]],
labels = c("", ""),
common.legend = T,
legend = "right",
nrow = 2)
grid_creditos
ggsave(paste("plots/C-1233-", categ2[n], "_2.png", sep = ""), width = 8, height = 6.5)
}
for (i in 1:length(categ)){
temp5 <- temp4[temp4$`Categoría de Riesgo` == categ[i] &
temp4$`Tipo de Crédito` == "Microempresas", ]
ggplot(temp5[temp5$Mes >= "2019-01-01", ], aes(x = Mes, y = estructura, group = caja))+
geom_line(aes(linetype = caja, color = caja), size = 1)+
geom_point(aes(color = caja, shape = caja), size = 2)+
theme(legend.title = element_blank())+
labs(x = "",
y = "Porcentaje",
title = "Estructura de Créditos Directos y Contingentes - Microempresas",
subtitle = paste("Categoría de Riesgo", categ[i], sep = " "))
ggsave(filename = paste("plots/C-1233-Microempresas", categ[i], ".jpg", sep = ""),
plot = last_plot(),
device = "jpg",
height = 6,
width = 8)
}
#C-1233- Estructura de Cr?ditos Directos y Contingentes por Tipo de Cr?dito y Categor?a de Riesgo del Deudor
rm(list = ls())
library(readxl)
library(dplyr)
library(tidyr)
library(stringr)
library(tseries)
library(ggplot2)
library(forecast)
library(fpp2)
library(zoo)
library(ggpubr)
theme_set(theme_pubr())
theme_set(theme_bw())
basedir <- "/raw/C-1233-/"
months <- list.files(paste0(getwd(), basedir), full.names = F, recursive = F)
for (i in 1:length(months)){
temp <- read_xls(paste0("raw/C-1233-/", months[i]))
colnames(temp) <- temp[4, ]
colnames(temp)
temp <- temp[c(26:38), c(1,2, 4, 5, 7, 11)]
temp[2:6, 1] <- temp[1, 1]
temp[9:13, 1] <- temp[8, 1]
temp <- temp[-7, ]
period <- unlist(strsplit(months[i], split = "_"))
temp$year <- period[1]
temp$mes <- period[2]
temp$mes <- gsub(temp$mes, pattern = ".xls", replacement = "")
if (i == 1){
temp4 <- temp
} else {
temp4 <- rbind(temp4, temp)
}
}
#format
temp4[, 3:8] <- apply(temp4[, 3:8], 2, function(x) as.numeric(x))
options(scipen = 999)
#order
temp4 <- temp4[order(temp4$year, temp4$mes), ]
#formato fecha
temp4$Mes <- paste(temp4$year, temp4$mes, 1, sep ="-")
temp4$Mes <- as.Date(temp4$Mes, format = "%Y-%m-%d")
#more cleaning
temp4 <- temp4[!temp4$`Categoría de Riesgo` == "Peq. Empr. (Miles S/.)", ]
temp4 <- temp4[!temp4$`Categoría de Riesgo` == "Peq. Empr. (Miles S/)", ]
temp4 <- temp4[!temp4$`Categoría de Riesgo` == "Microempr. (Miles S/.)", ]
temp4 <- temp4[!temp4$`Categoría de Riesgo` == "Microempr. (Miles S/)", ]
temp4$`Categoría de Riesgo`[temp4$`Categoría de Riesgo`== "Pérdida"] <- "Perdida"
temp4 <- pivot_longer(temp4, cols = 3:6, names_to = "caja", values_to = "estructura")
temp4$caja[temp4$caja == "CMAC AREQUIPA"] <- "CMAC Arequipa"
temp4$caja[temp4$caja == "CMAC CUSCO S A"] <- "CMAC Cusco"
temp4$caja[temp4$caja == "CMAC PIURA"] <- "CMAC Piura"
temp4$caja[temp4$caja == "CMAC HUANCAYO"] <- "CMAC Huancayo"
##ggplot
categ <- unlist(unique(temp4$`Tipo de Crédito`))
categ
empty_list <- vector(mode = "list", len = 0)
empty_list
table(temp4$`Categoría de Riesgo`)
categ2 <- unlist(unique(temp4$`Categoría de Riesgo`))
View(temp4)
rm(list = ls())
library(readxl)
library(dplyr)
library(tidyr)
library(stringr)
library(tseries)
library(ggplot2)
library(forecast)
library(fpp2)
library(zoo)
library(ggpubr)
theme_set(theme_pubr())
theme_set(theme_bw())
basedir <- "/raw/C-1233-/"
months <- list.files(paste0(getwd(), basedir), full.names = F, recursive = F)
for (i in 1:length(months)){
temp <- read_xls(paste0("raw/C-1233-/", months[i]))
colnames(temp) <- temp[4, ]
colnames(temp)
temp <- temp[c(26:38), c(1,2, 4, 5, 7, 11)]
temp[2:6, 1] <- temp[1, 1]
temp[9:13, 1] <- temp[8, 1]
temp <- temp[-7, ]
period <- unlist(strsplit(months[i], split = "_"))
temp$year <- period[1]
temp$mes <- period[2]
temp$mes <- gsub(temp$mes, pattern = ".xls", replacement = "")
if (i == 1){
temp4 <- temp
} else {
temp4 <- rbind(temp4, temp)
}
}
#format
temp4[, 3:8] <- apply(temp4[, 3:8], 2, function(x) as.numeric(x))
options(scipen = 999)
#order
temp4 <- temp4[order(temp4$year, temp4$mes), ]
#formato fecha
temp4$Mes <- paste(temp4$year, temp4$mes, 1, sep ="-")
temp4$Mes <- as.Date(temp4$Mes, format = "%Y-%m-%d")
#more cleaning
temp4 <- temp4[!temp4$`Categoría de Riesgo` == "Peq. Empr. (Miles S/.)", ]
temp4 <- temp4[!temp4$`Categoría de Riesgo` == "Peq. Empr. (Miles S/)", ]
temp4 <- temp4[!temp4$`Categoría de Riesgo` == "Microempr. (Miles S/.)", ]
temp4 <- temp4[!temp4$`Categoría de Riesgo` == "Microempr. (Miles S/)", ]
temp4$`Categoría de Riesgo`[temp4$`Categoría de Riesgo`== "Pérdida"] <- "Perdida"
temp4 <- pivot_longer(temp4, cols = 3:6, names_to = "caja", values_to = "estructura")
temp4$caja[temp4$caja == "CMAC AREQUIPA"] <- "CMAC Arequipa"
temp4$caja[temp4$caja == "CMAC CUSCO S A"] <- "CMAC Cusco"
temp4$caja[temp4$caja == "CMAC PIURA"] <- "CMAC Piura"
temp4$caja[temp4$caja == "CMAC HUANCAYO"] <- "CMAC Huancayo"
##ggplot
categ <- unlist(unique(temp4$`Tipo de Crédito`))
categ
empty_list <- vector(mode = "list", len = 0)
empty_list
table(temp4$`Categoría de Riesgo`)
categ2 <- unlist(unique(temp4$`Categoría de Riesgo`))
for (n in 1:length(categ2)){
for (i in 1:length(categ)){
temp5 <- temp4[temp4$`Tipo de Crédito` == categ[i] &
temp4$`Categoría de Riesgo`== categ2[n], ]
empty_list[[i]] <- local({
i <- i
a <- ggplot(temp5[temp5$Mes >= "2019-01-01", ], aes(x = Mes, y = estructura, group = caja))+
geom_line(aes(linetype = caja, color = caja), size = 1)+
geom_point(aes(color = caja, shape = caja), size = 2)+
theme(legend.title = element_blank())+
labs(x = "",
y = "Porcentaje",
title = paste("Categoría de Riesgo", categ2[n],
"-",
categ[i],
sep = " "))
print(a)
})
}
grid_creditos <- ggarrange(empty_list[[1]], empty_list[[2]],
labels = c("", ""),
common.legend = T,
legend = "right",
nrow = 2)
grid_creditos
ggsave(paste("plots/C-1233-", categ2[n], "_2.png", sep = ""), width = 8, height = 6.5)
}
categ
empty_list
empty_list
table(temp4$`Categoría de Riesgo`)
categ2 <- unlist(unique(temp4$`Categoría de Riesgo`))
View(temp4)
temp4 <- temp4[temp4$caja == "CMAC Arequipa"|
temp4$caja == "CMAC Huancayo", ]
for (n in 1:length(categ2)){
for (i in 1:length(categ)){
temp5 <- temp4[temp4$`Tipo de Crédito` == categ[i] &
temp4$`Categoría de Riesgo`== categ2[n], ]
empty_list[[i]] <- local({
i <- i
a <- ggplot(temp5, aes(x = Mes, y = estructura, group = caja))+
geom_line(aes(linetype = caja, color = caja), size = 1)+
geom_point(aes(color = caja, shape = caja), size = 2)+
theme(legend.title = element_blank())+
labs(x = "",
y = "Porcentaje",
title = paste("Categoría de Riesgo", categ2[n],
"-",
categ[i],
sep = " "))
print(a)
})
}
grid_creditos <- ggarrange(empty_list[[1]], empty_list[[2]],
labels = c("", ""),
common.legend = T,
legend = "right",
nrow = 2)
grid_creditos
ggsave(paste("plots/C-1233-", categ2[n], "_2.png", sep = ""), width = 8, height = 6.5)
}
rm(list = ls())
library(readxl)
library(dplyr)
library(tidyr)
library(stringr)
library(tseries)
library(ggplot2)
library(forecast)
library(fpp2)
theme_set(theme_bw())
basedir <- "/raw/C-1230-/"
months <- list.files(paste0(getwd(), basedir), full.names = F, recursive = F)
length(months)
months[1]
cajas <- c("CMAC Arequipa",
"CMAC Huancayo")
for (n in 1:length(months)){
data <- read_xls(paste0("raw/C-1230-/", months[n]))
data <- data[, c(1, 6)]
colnames(data) <- data[3, ]
for (i in 1:length(cajas)){
temp1 <- data[data$Empresas == cajas[i], ]
if (i == 1){
temp2 <- temp1
} else {
temp2 <- rbind(temp2, temp1)
}
}
temp2 <- temp2[!is.na(temp2$Empresas), ]
period <- unlist(strsplit(months[n], split = "_"))
temp2$year <- period[1]
temp2$mes <- period[2]
temp2$mes <- gsub(temp2$mes, pattern = ".xls", replacement = "")
if (n == 1){
temp3 <- temp2
} else {
temp3 <- rbind(temp3, temp2)
}
}
#temp 3 = long! (this is for ggplot2)
MorosidadSBS <- pivot_wider(temp3, names_from = Empresas, values_from = `Morosidad según criterio contable SBS2/`)
#format
MorosidadSBS[, ] <- apply(MorosidadSBS[, ], 2, function(x) as.numeric(x))
#order by year and month
MorosidadSBS <- MorosidadSBS[order(MorosidadSBS$year, MorosidadSBS$mes), ]
MorosidadSBS$Mes <- paste(MorosidadSBS$year, MorosidadSBS$mes, 1, sep ="-")
MorosidadSBS$Mes <- as.Date(MorosidadSBS$Mes, format = "%Y-%m-%d")
#return to table temp2
temp2 <- pivot_longer(MorosidadSBS, cols = 3:6, names_to = "caja", values_to = "morosidad")
temp2 <- temp2[temp2$caja == "CMAC Arequipa"|
temp2$caja == "CMAC Huancayo", ]
View(MorosidadSBS)
#return to table temp2
temp2 <- pivot_longer(MorosidadSBS, cols = 3:4, names_to = "caja", values_to = "morosidad")
temp2 <- temp2[temp2$caja == "CMAC Arequipa"|
temp2$caja == "CMAC Huancayo", ]
#ggplot2
ggplot(temp2, aes(x = Mes, y = morosidad, group = caja))+
geom_line(aes(linetype = caja, color = caja), size = 1)+
geom_point(aes(color = caja, shape = caja), size = 2)+
theme(legend.title = element_blank())+
labs(x = "",
y = "Porcentaje",
title = "Morosidad criterio SBS")
ggsave("plots/C-1230-MorosidadSBS.jpg", width = 8, height = 6.5)
